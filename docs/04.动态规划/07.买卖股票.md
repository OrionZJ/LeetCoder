# 动规之买卖股票

- 121.买卖股票的最佳时机（只能买卖一次）
- 122.买卖股票的最佳时机II（可以买卖多次）
- 123.买卖股票的最佳时机III（最多买卖两次）
- 188.买卖股票的最佳时机IV（最多买卖k次）
- 309.最佳买卖股票时机含冷冻期（买卖多次，卖出有一天冷冻期）
- 714.买卖股票的最佳时机含手续费（买卖多次，每次有手续费）

## 买卖股票的最佳时机

**股票只能买卖一次，问最大利润**

- 贪心
    - 取最左最小值，取最右最大值，差值就是最大利润
    
- 动规
    - `dp[i][0] `表示第i天不持有股票所得现金。
        - 第i-1天就不持有股票，那么就保持现状`dp[i - 1][0]`
        
        - 第i天卖出股票，所得现金就是按照今天股票佳价格卖出后所得现金
        
            `dp[i][0] = max(dp[i - 1][0], prices[i] + dp[i - 1][1]);`
        
    - `dp[i][1]` 表示第i天持有股票所得现金。
        - 第i-1天就持有股票，那么就保持现状，`dp[i - 1][1]`
        
        - 第i天买入股票，所得现金就是买入今天的股票后所得现金
        
            `dp[i][1] = max(dp[i - 1][1], -prices[i]);`

动规时使用滚动数组可降低空间复杂度：

```c++
vector<vector<int>> dp(2, vector<int>(2));
```

## 买卖股票的最佳时机II

可以多次买卖股票，问最大收益。

- 贪心
    - 收集每天的正利润：
    
        ` result += max(prices[i] - prices[i - 1], 0);`
    
- 动态规划

    - `dp[i][0]` 表示第i天不持有股票所得现金
        - 第i-1天就不持有股票，保持现状`dp[i - 1][0]`
        - 第i天卖出股票`dp[i - 1][1] + prices[i]`
    - `dp[i][1] `表示第i天持有股票所得现金
        - 第i-1天就持有股票，保持现状`dp[i - 1][1]`
        - 第i天买入股票`dp[i - 1][0] - prices[i]`

## 买卖股票的最佳时机III

最多买卖两次，问最大收益。

一天可能有五个状态：

1. 没有操作
2. 第一次买入
3. 第一次卖出
4. 第二次买入
5. 第二次卖出

`dp[i][j]`中 i表示第i天，j为 [0 - 4] 五个状态，`dp[i][j]`表示第i天状态j时持有的最大金额。

- `dp[i][1]`状态

    - 第i天买入股票了，`dp[i][1] = dp[i-1][0] - prices[i]`

    - 第i天没有操作`dp[i][1] = dp[i - 1][1]``

- `dp[i][2]`状态：
    - 第i天卖出股票了`dp[i][2] = dp[i - 1][1] + prices[i]`
    - 第i天没有操作`dp[i][2] = dp[i - 1][2]`
- `dp[i][3] = max(dp[i - 1][3], dp[i - 1][2] - prices[i]);`
- `dp[i][4] = max(dp[i - 1][4], dp[i - 1][3] + prices[i]);`

## 买卖股票的最佳时机IV

最多买卖k笔交易，问最大收益。

- 0 表示不操作
- 1 第一次买入
- 2 第一次卖出
- 3 第二次买入
- 4 第二次卖出
- .....

**除了0以外，偶数就是卖出，奇数就是买入**

```c++
for (int j = 0; j < 2 * k - 1; j += 2) {
    dp[i][j + 1] = max(dp[i - 1][j + 1], dp[i - 1][j] - prices[i]);
    dp[i][j + 2] = max(dp[i - 1][j + 2], dp[i - 1][j + 1] + prices[i]);
}
```

## 最佳买卖股票时机含冷冻期

可以多次买卖但每次卖出有冷冻期1天。

`dp[i][j]`：第i天状态为j，所剩的最多现金为`dp[i][j]`

- 状态一：买入股票状态（今天买入股票，或者是之前就买入了股票然后没有操作）
- 卖出股票状态，这里就有两种卖出股票状态
    - 状态二：两天前就卖出了股票，度过了冷冻期，一直没操作，今天保持卖出股票状态
    - 状态三：今天卖出了股票
- 状态四：今天为冷冻期状态，但冷冻期状态不可持续，只有一天！

`dp[i][0]`：

```c++
dp[i][0] = max(dp[i - 1][0], max(dp[i - 1][3]- prices[i], dp[i - 1][1]) - prices[i];
dp[i][1] = max(dp[i - 1][1], dp[i - 1][3]);
dp[i][2] = dp[i - 1][0] + prices[i];
dp[i][3] = dp[i - 1][2];
```

## 买卖股票的最佳时机含手续费

可以多次买卖，但每次有手续费。

```c++
for (int i = 1; i < n; i++) {
	dp[i][0] = max(dp[i - 1][0], dp[i - 1][1] + prices[i] - fee);
	dp[i][1] = max(dp[i - 1][1], dp[i - 1][0] - prices[i]);
}
```

