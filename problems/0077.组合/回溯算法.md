# 回溯算法

解决问题分类：

- 组合（不强调顺序）
- 分割
- 子集
- 排列（强调顺序）
- 棋盘
- 其它

## 什么是回溯法

回溯法，也称回溯搜索法，是一种搜索的方式。

回溯是递归的副产品，有递归就有回溯。

回溯的本质是**穷举**，可以通过一些**剪枝**的操作提高效率。

回溯法的问题可以抽象为**树形结构**。

回溯法解决的是在集合中递归查找子集，**集合的大小构成了树的宽度，递归的深度，构成的树的深度**。

递归就要有终止条件，所以是一棵高度有限的树（N叉树）。

## 回溯三部曲

1. 递归函数返回值及参数

    ```c++
    void backtracking(参数)
    ```

2. 回溯函数终止条件

    ```c++
    if (终止条件) {
        存放结果;
        return;
    }
    ```

3. 回溯搜索遍历过程

    ```c++
    for (选择：本层集合中元素（树中节点孩子的数量就是集合的大小）) {
        处理节点;
        backtracking(路径，选择列表); // 递归
        回溯，撤销处理结果
    }
    ```

    **for循环可以理解是横向遍历，backtracking（递归）就是纵向遍历**，叶子节点一般就是找的其中一个结果。

回溯算法模板框架如下：

```c++
void backtracking(参数) {
    if (终止条件) {
        存放结果;
        return;
    }

    for (选择：本层集合中元素（树中节点孩子的数量就是集合的大小）) {
        处理节点;
        backtracking(路径，选择列表); // 递归
        回溯，撤销处理结果
    }
}
```

## 剪枝优化

将没有意义的遍历剪枝优化

# 组合问题

给定两个整数 n 和 k，返回 1 ... n 中所有可能的 k 个数的组合。

## 回溯三部曲：

1. 递归函数返回值及参数

    定义两个全局变量，一个用来存放符合条件单一结果，一个用来存放符合条件结果的集合

    函数里一定有两个参数，n、k，然后还需要一个参数，为int型变量startIndex，用来记录本层递归的中，集合从哪里开始遍历。

    ```c++
    vector<vector<int>> result; // 存放符合条件结果的集合
    vector<int> path; // 用来存放符合条件单一结果
    void backtracking(int n, int k, int startIndex) 
    ```

2. 回溯函数终止条件

    ```c++
    if (path.size() == k) {
        result.push_back(path);
        return;
    }
    ```

3. 回溯搜索遍历过程

    for循环每次从startIndex开始遍历，然后用path保存取到的节点i

    ```c++
    for (int i = startIndex; i <= n; i++) { // 控制树的横向遍历
        path.push_back(i); // 处理节点 
        backtracking(n, k, i + 1); // 递归：控制树的纵向遍历，注意下一层搜索要从i+1开始
        path.pop_back(); // 回溯，撤销处理的节点
    }
    ```

    backtracking（递归函数）通过不断调用自己一直往深处遍历，总会遇到叶子节点，遇到了叶子节点就要返回。

    backtracking的下面部分就是回溯的操作了，撤销本次处理的结果。

## 剪枝优化

**可以剪枝的地方在递归中每一层的for循环所选择的起始位置**

**如果for循环选择的起始位置之后的元素个数已经不足我们需要的元素个数了，那么就没有必要搜索了**。

接下来看一下优化过程如下：

1. 已经选择的元素个数：`path.size()`;
2. 还需要的元素个数为: ` path.size()`;
3. 在集合n中至多要从该起始位置 : `n - (k - path.size()) + 1`，开始遍历。+1，因为包括起始位置，要一个左闭的集合。

优化后的for循环：

```c++
for (int i = startIndex; i <= n - (k - path.size()) + 1; i++) // i为本次搜索的起始位置
```

